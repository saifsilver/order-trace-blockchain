(()=>{var e={128:(e,t,r)=>{r(818).config();var n=r(252),i=r(268),o=r(829),s=r(729),a=r(494),u=(r(670),n()),c=process.env.JWT_SECRET,l=new a;u.use(i.json());var f=function(e,t,r){var n=e.headers.authorization;if(!n)return t.status(401).json({error:"Unauthorized. No token provided."});var i=n.split(" ")[1];o.verify(i,c,(function(n,i){if(n)return t.status(403).json({error:"Forbidden. Invalid token."});e.user=i,r()}))};u.post("/login",(function(e,t){var r=e.body,n=r.username,i=r.password;if(!n||!i)return t.status(400).json({error:"Username and password are required."});var a=1,u="admin",l="$2a$10$Q75aOyhVDoM6HUq280yMzu/dO6.w3WHs7zSQeDqcFfjM5satXooua";s.compare(i,l,(function(e,r){if(e||!r)return t.status(401).json({error:"Unauthorized. Invalid username or password."});var n=o.sign({id:a,username:u},c,{expiresIn:"1h"});t.status(200).json({token:n})}))})),u.get("/blockchain",f,(function(e,t){t.json(l.chain)})),u.post("/order",f,(function(e,t){var r=e.body,n=r.id,i=r.products,o=r.customer;if(!n||!i||!o)return t.status(400).json({error:"Invalid request. Missing required fields."});var s={id:n,products:i,customer:o};l.createOrderTransaction(s),t.json({message:"Order added to the pending transactions."})})),u.post("/delivery",f,(function(e,t){var r=e.body,n=r.orderId,i=r.deliveryId,o=r.status,s=r.deliveryPerson;if(!(n&&i&&o&&s))return t.status(400).json({error:"Invalid request. Missing required fields."});var a={orderId:n,deliveryId:i,status:o,deliveryPerson:s,timestamp:new Date};l.createDeliveryTransaction(a),t.json({message:"Delivery added to the pending transactions."})})),u.get("/mine",f,(function(e,t){l.minePendingTransactions(),t.json({message:"Pending transactions mined and added to the blockchain."})})),u.use((function(e,t,r,n){console.error(e.stack),r.status(500).json({error:"Internal server error."})})),u.listen(3e3,(function(){console.log("Server is running on port ".concat(3e3))})),e.exports=u},494:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var u=r(579),c=function(){return s((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";i(this,e),this.timestamp=t,this.transactions=r,this.previousHash=n,this.hash=this.calculateHash(),this.nonce=0}),[{key:"calculateHash",value:function(){return u(this.timestamp+JSON.stringify(this.transactions)+this.previousHash+this.nonce).toString()}},{key:"mineBlock",value:function(e){for(;this.hash.substring(0,e)!==Array(e+1).join("0");)this.nonce++,this.hash=this.calculateHash();console.log("Block mined: "+this.hash)}}])}(),l=function(){return s((function e(){i(this,e),this.chain=[this.createGenesisBlock()],this.difficulty=4,this.pendingTransactions=[]}),[{key:"createGenesisBlock",value:function(){return new c("01/01/2024",[],"0")}},{key:"getLatestBlock",value:function(){return this.chain[this.chain.length-1]}},{key:"createOrderTransaction",value:function(e){var t={type:"order",data:e};this.pendingTransactions.push(t)}},{key:"createDeliveryTransaction",value:function(e){var t={type:"delivery",data:e};this.pendingTransactions.push(t)}},{key:"minePendingTransactions",value:function(){var e=new c(Date.now(),this.pendingTransactions);e.mineBlock(this.difficulty),console.log("Block successfully mined!"),this.chain.push(e),this.pendingTransactions=[]}},{key:"isChainValid",value:function(){for(var e=1;e<this.chain.length;e++){var t=this.chain[e],r=this.chain[e-1];if(t.hash!==t.calculateHash())return!1;if(t.previousHash!==r.hash)return!1}return!0}}])}();e.exports=l},670:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==t(r)?r:r+""}var o=n((function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.data=r}));e.exports=o},729:e=>{"use strict";e.exports=require("bcryptjs")},268:e=>{"use strict";e.exports=require("body-parser")},579:e=>{"use strict";e.exports=require("crypto-js/sha256")},818:e=>{"use strict";e.exports=require("dotenv")},252:e=>{"use strict";e.exports=require("express")},829:e=>{"use strict";e.exports=require("jsonwebtoken")}},t={};(function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports})(128)})();